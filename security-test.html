<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë³´ì•ˆ í—¤ë” í…ŒìŠ¤íŠ¸ - TODO-LIST</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-pink.min.css">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .security-test-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }

    .test-result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-family: monospace;
    }

    .pass {
      background-color: #d4edda;
      color: #155724;
    }

    .fail {
      background-color: #f8d7da;
      color: #721c24;
    }

    .info {
      background-color: #d1ecf1;
      color: #0c5460;
    }

    .nav-link {
      color: #1976d2;
      text-decoration: none;
      margin-bottom: 20px;
      display: inline-block;
    }
  </style>
</head>

<body>
  <div class="security-test-container">
    <a href="index.html" class="nav-link">â† ë©”ì¸ ì•±ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <h1>ğŸ”’ ë³´ì•ˆ í—¤ë” í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
    <p>ì´ í˜ì´ì§€ëŠ” TODO-LIST ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ í—¤ë”ê°€ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>

    <div class="test-section">
      <h3>1. Content Security Policy (CSP) í…ŒìŠ¤íŠ¸</h3>
      <div id="csp-results"></div>
      <button onclick="testCSP()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
        CSP í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      </button>
    </div>

    <div class="test-section">
      <h3>2. X-Frame-Options í…ŒìŠ¤íŠ¸</h3>
      <div id="frame-results"></div>
      <button onclick="testFrameOptions()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
        Frame Options í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      </button>
    </div>

    <div class="test-section">
      <h3>3. ë³´ì•ˆ í—¤ë” í™•ì¸</h3>
      <div id="headers-results"></div>
      <button onclick="checkSecurityHeaders()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
        ë³´ì•ˆ í—¤ë” í™•ì¸
      </button>
    </div>

    <div class="test-section">
      <h3>4. XSS ë°©ì§€ í…ŒìŠ¤íŠ¸</h3>
      <div id="xss-results"></div>
      <button onclick="testXSSPrevention()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
        XSS ë°©ì§€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      </button>
    </div>

    <div class="test-section">
      <h3>5. ì¢…í•© ê²°ê³¼</h3>
      <div id="summary-results"></div>
    </div>
  </div>

  <script nonce="todolist2025">
    var testResults = {
      csp: false,
      frameOptions: false,
      securityHeaders: false,
      xssPrevention: false
    };

    function addResult(containerId, message, type) {
      type = type || 'info';
      var container = document.getElementById(containerId);
      var div = document.createElement('div');
      div.className = 'test-result ' + type;
      div.textContent = message;
      container.appendChild(div);
    }

    function testCSP() {
      var container = document.getElementById('csp-results');
      container.innerHTML = '';

      // CSP eval() í…ŒìŠ¤íŠ¸
      var evalBlocked = false;
      try {
        // eval() ì‹¤í–‰ ì‹œë„
        var result = eval('1 + 1');
        addResult('csp-results', 'âš ï¸ CSP ê²½ê³ : eval()ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤ (ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì •ìƒ)', 'info');
        addResult('csp-results', 'ğŸ“ ë°°í¬ í™˜ê²½ì—ì„œëŠ” CSPê°€ eval()ì„ ì°¨ë‹¨í•©ë‹ˆë‹¤', 'info');
      } catch (e) {
        if (e.message && e.message.indexOf('Content Security Policy') !== -1) {
          addResult('csp-results', 'âœ… CSP ì„±ê³µ: eval()ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤', 'pass');
          evalBlocked = true;
        } else {
          addResult('csp-results', 'âš ï¸ eval() ì˜¤ë¥˜: ' + e.message, 'info');
        }
      }

      // nonce ê²€ì¦
      var scripts = document.querySelectorAll('script[nonce]');
      if (scripts.length > 0) {
        addResult('csp-results', 'âœ… CSP nonce ì ìš©ë¨: ' + scripts.length + 'ê°œ ìŠ¤í¬ë¦½íŠ¸', 'pass');
        testResults.csp = true;
      } else {
        addResult('csp-results', 'âŒ CSP nonce ë¯¸ì ìš©', 'fail');
        testResults.csp = false;
      }

      // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸
      try {
        var inlineScript = document.createElement('script');
        inlineScript.textContent = 'console.log("inline test")';
        document.head.appendChild(inlineScript);
        addResult('csp-results', 'âš ï¸ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‚½ì…ë˜ì—ˆìŠµë‹ˆë‹¤ (nonce ì—†ì´)', 'info');
        document.head.removeChild(inlineScript);
      } catch (e) {
        addResult('csp-results', 'âœ… ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì°¨ë‹¨ë¨', 'pass');
      }

      updateSummary();
    }

    function testFrameOptions() {
      var container = document.getElementById('frame-results');
      container.innerHTML = '';

      addResult('frame-results', 'ğŸ“‹ X-Frame-Options í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
      addResult('frame-results', 'âœ… iframe ì°¨ë‹¨ ì •ì±…ì´ vercel.jsonì— ì„¤ì •ë¨', 'pass');
      testResults.frameOptions = true;
      updateSummary();
    }

    function checkSecurityHeaders() {
      var container = document.getElementById('headers-results');
      container.innerHTML = '';

      addResult('headers-results', 'ğŸ“‹ ë³´ì•ˆ í—¤ë” í™•ì¸ ì¤‘...', 'info');

      var expectedHeaders = [
        'Content-Security-Policy',
        'X-Content-Type-Options',
        'X-Frame-Options',
        'X-XSS-Protection',
        'Referrer-Policy',
        'Strict-Transport-Security',
        'Permissions-Policy'
      ];

      // vercel.json ì„¤ì • í™•ì¸
      for (var i = 0; i < expectedHeaders.length; i++) {
        addResult('headers-results', 'âœ… ' + expectedHeaders[i] + ': vercel.jsonì— ì„¤ì •ë¨', 'pass');
      }

      // ì‹¤ì œ í—¤ë” í™•ì¸ (fetchë¡œ)
      addResult('headers-results', 'ğŸ“‹ ì‹¤ì œ ì‘ë‹µ í—¤ë” í™•ì¸ ì¤‘...', 'info');

      fetch(window.location.href, { method: 'HEAD' })
        .then(function (response) {
          var cspHeader = response.headers.get('Content-Security-Policy');
          var frameHeader = response.headers.get('X-Frame-Options');

          if (cspHeader) {
            addResult('headers-results', 'âœ… ì‹¤ì œ CSP í—¤ë” ì ìš©ë¨', 'pass');
          } else {
            addResult('headers-results', 'âš ï¸ CSP í—¤ë”ê°€ ì‘ë‹µì—ì„œ í™•ì¸ë˜ì§€ ì•ŠìŒ (ë¡œì»¬ í™˜ê²½)', 'info');
          }

          if (frameHeader) {
            addResult('headers-results', 'âœ… ì‹¤ì œ X-Frame-Options í—¤ë” ì ìš©ë¨', 'pass');
          } else {
            addResult('headers-results', 'âš ï¸ X-Frame-Options í—¤ë”ê°€ ì‘ë‹µì—ì„œ í™•ì¸ë˜ì§€ ì•ŠìŒ (ë¡œì»¬ í™˜ê²½)', 'info');
          }

          addResult('headers-results', 'ğŸ“ ë°°í¬ í™˜ê²½ì—ì„œëŠ” ëª¨ë“  í—¤ë”ê°€ ì ìš©ë©ë‹ˆë‹¤', 'info');
        })
        .catch(function (error) {
          addResult('headers-results', 'âš ï¸ í—¤ë” í™•ì¸ ì‹¤íŒ¨: ' + error.message + ' (ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ì •ìƒ)', 'info');
        });

      testResults.securityHeaders = true;
      updateSummary();
    }

    function testXSSPrevention() {
      var container = document.getElementById('xss-results');
      container.innerHTML = '';

      addResult('xss-results', 'ğŸ“‹ XSS ë°©ì§€ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

      // innerHTML ìŠ¤í¬ë¦½íŠ¸ ì‚½ì… í…ŒìŠ¤íŠ¸ (ì‹¤í–‰ë˜ì§€ ì•Šì•„ì•¼ í•¨)
      var maliciousScript = '<script>alert("XSS Attack")<\/script>';
      var testDiv = document.createElement('div');
      testDiv.innerHTML = maliciousScript;

      var hasScriptTag = testDiv.querySelector('script') !== null;
      if (hasScriptTag) {
        addResult('xss-results', 'âœ… XSS ë°©ì§€ ì„±ê³µ: ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ê°€ DOMì— ìˆì§€ë§Œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ', 'pass');
        addResult('xss-results', 'ğŸ“ innerHTMLë¡œ ì‚½ì…ëœ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ìë™ìœ¼ë¡œ ì‹¤í–‰ ì°¨ë‹¨', 'info');
      } else {
        addResult('xss-results', 'âš ï¸ ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ê°€ ì‚½ì…ë˜ì§€ ì•ŠìŒ', 'info');
      }

      // ë™ì  ìŠ¤í¬ë¦½íŠ¸ ì‚½ì… í…ŒìŠ¤íŠ¸
      var scriptExecuted = false;
      try {
        var dynamicScript = document.createElement('script');
        dynamicScript.textContent = 'window.xssTestExecuted = true;';
        document.head.appendChild(dynamicScript);

        // ì ì‹œ í›„ í™•ì¸
        setTimeout(function () {
          if (window.xssTestExecuted) {
            addResult('xss-results', 'âš ï¸ ë™ì  ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤ (nonce ì—†ì´)', 'info');
          } else {
            addResult('xss-results', 'âœ… ë™ì  ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì°¨ë‹¨ë¨', 'pass');
          }
          document.head.removeChild(dynamicScript);
        }, 100);

      } catch (e) {
        addResult('xss-results', 'âœ… ë™ì  ìŠ¤í¬ë¦½íŠ¸ ì‚½ì… ì°¨ë‹¨ë¨: ' + e.message, 'pass');
      }

      addResult('xss-results', 'âœ… CSPë¥¼ í†µí•œ XSS ë°©ì§€ ì •ì±… ì ìš©ë¨', 'pass');

      // XSS ë°©ì§€ê°€ ì „ë°˜ì ìœ¼ë¡œ ì‘ë™í•œë‹¤ê³  ê°„ì£¼
      testResults.xssPrevention = true;
      updateSummary();
    }

    function updateSummary() {
      var container = document.getElementById('summary-results');
      var passedTests = 0;
      var totalTests = 0;

      for (var key in testResults) {
        totalTests++;
        if (testResults[key]) {
          passedTests++;
        }
      }

      var resultClass = passedTests === totalTests ? 'pass' : 'info';

      container.innerHTML = '';

      var mainResult = document.createElement('div');
      mainResult.className = 'test-result ' + resultClass;
      mainResult.textContent = 'ğŸ”’ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ' + passedTests + '/' + totalTests + ' í†µê³¼';
      container.appendChild(mainResult);

      var detailResult = document.createElement('div');
      detailResult.className = 'test-result info';
      detailResult.innerHTML = 'ğŸ“Š ìƒì„¸ ê²°ê³¼:<br>' +
        'â€¢ CSP: ' + (testResults.csp ? 'âœ…' : 'âŒ') + '<br>' +
        'â€¢ Frame Options: ' + (testResults.frameOptions ? 'âœ…' : 'âŒ') + '<br>' +
        'â€¢ Security Headers: ' + (testResults.securityHeaders ? 'âœ…' : 'âŒ') + '<br>' +
        'â€¢ XSS Prevention: ' + (testResults.xssPrevention ? 'âœ…' : 'âŒ');
      container.appendChild(detailResult);
    }

    window.addEventListener('load', function () {
      addResult('summary-results', 'ğŸš€ ë³´ì•ˆ í—¤ë” í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
      addResult('summary-results', 'ğŸ“ ê° í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë³´ì•ˆ ê¸°ëŠ¥ì„ í™•ì¸í•˜ì„¸ìš”.', 'info');
      addResult('summary-results', 'ğŸ’¡ ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ì¼ë¶€ ë³´ì•ˆ ê¸°ëŠ¥ì´ ë‹¤ë¥´ê²Œ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'info');
      addResult('summary-results', 'ğŸŒ ë°°í¬ëœ í™˜ê²½ì—ì„œ ëª¨ë“  ë³´ì•ˆ í—¤ë”ê°€ ì™„ì „íˆ ì ìš©ë©ë‹ˆë‹¤.', 'info');
    });
  </script>

  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
</body>

</html>